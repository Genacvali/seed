# SEED Agent v3 üöÄ\n\n**Single Binary Monitoring System with Plugin Architecture**\n\nSEED Agent is a lightweight, containerized monitoring and alerting system designed for modern infrastructure. It provides a unified solution with external configuration, pluggable alert processing, and best-in-class operational practices.\n\n## üèóÔ∏è Architecture Overview\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ   External      ‚îÇ    ‚îÇ   SEED Agent    ‚îÇ    ‚îÇ  Infrastructure ‚îÇ\n‚îÇ  Configuration  ‚îÇ    ‚îÇ   (Container)   ‚îÇ    ‚îÇ   (Containers)  ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ ‚Ä¢ seed.yaml     ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚î§ ‚Ä¢ FastAPI Web   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚Ä¢ RabbitMQ      ‚îÇ\n‚îÇ ‚Ä¢ plugins.py    ‚îÇ    ‚îÇ ‚Ä¢ Async Worker  ‚îÇ    ‚îÇ ‚Ä¢ Redis         ‚îÇ\n‚îÇ ‚Ä¢ logs/         ‚îÇ    ‚îÇ ‚Ä¢ Plugin Loader ‚îÇ    ‚îÇ ‚Ä¢ (Prometheus)  ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n### Key Features\n\n- **üéØ Single Binary**: One executable handles web server, worker, and plugin management\n- **üìÅ External Config**: Configuration and plugins mounted from outside the container\n- **üîå Plugin System**: All monitoring plugins in one file, easily customizable\n- **üê≥ Docker Native**: Complete containerized solution with docker-compose\n- **üîÑ Hot Reload**: Configuration and plugins can be reloaded without restart\n- **üìä Observability**: Built-in metrics, health checks, and structured logging\n- **üö® Multi-Channel**: Supports Mattermost, Slack, and email notifications\n\n## üöÄ Quick Start\n\n### Prerequisites\n\n- Docker and Docker Compose\n- Make (optional, for convenience commands)\n\n### 1. Start the System\n\n```bash\n# Development mode (with hot reload)\nmake dev\n\n# Production mode\nmake up\n\n# With metrics (Prometheus + Grafana)\nmake metrics\n```\n\n### 2. Access Services\n\n- **SEED Agent API**: http://localhost:8080\n- **Health Check**: http://localhost:8080/health\n- **Statistics**: http://localhost:8080/stats\n- **RabbitMQ Management**: http://localhost:15672 (seed/seed123)\n- **Grafana** (if metrics enabled): http://localhost:3000 (admin/admin123)\n\n### 3. Send Test Alert\n\n```bash\ncurl -X POST http://localhost:8080/alert \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"alerts\": [{\n      \"labels\": {\n        \"alertname\": \"DiskSpaceHigh\",\n        \"instance\": \"web-01:9090\",\n        \"severity\": \"warning\"\n      },\n      \"annotations\": {\n        \"description\": \"Disk usage is above 80%\"\n      }\n    }]\n  }'\n```\n\n## üìã Configuration\n\n### seed.yaml Structure\n\n```yaml\n# System configuration\nsystem:\n  agent:\n    bind_host: \"0.0.0.0\"\n    bind_port: 8080\n    debug: false\n  alerts:\n    ttl_seconds: 30\n    max_retries: 3\n\n# Infrastructure (RabbitMQ, Redis)\ninfrastructure:\n  rabbitmq:\n    host: \"rabbitmq\"\n    port: 5672\n    username: \"seed\"\n    password: \"seed123\"\n  redis:\n    host: \"redis\"\n    port: 6379\n\n# Notification channels\nnotifications:\n  mattermost:\n    enabled: true\n    webhook_url: \"https://your-mattermost.com/hooks/...\"\n    channel: \"alerts\"\n\n# Host groups and overrides\nhosts:\n  groups:\n    mongo-prod:\n      hosts: [\"mongo-prod-01\", \"mongo-prod-02\"]\n      overrides:\n        mongo_host: \"mongo-prod-01\"\n        username: \"monitoring\"\n\n# Alert routing to plugins\nrouting:\n  alerts:\n    DiskSpaceHigh:\n      plugin: \"host_inventory\"\n      payload:\n        paths: [\"/\", \"/data\"]\n        alert_type: \"disk_space\"\n        priority: \"high\"\n```\n\n### Adding Custom Plugins\n\nEdit `plugins.py` to add new monitoring plugins:\n\n```python\nasync def my_custom_plugin(host: str, labels: Dict[str, str], \n                          annotations: Dict[str, str], \n                          payload: Dict[str, Any]) -> Optional[str]:\n    \"\"\"Custom monitoring plugin\"\"\"\n    # Your monitoring logic here\n    return f\"üîç Custom check for {host}: OK\"\n\n# Register in PLUGINS dict\nPLUGINS = {\n    \"host_inventory\": host_inventory,\n    \"mongo_hot\": mongo_hot,\n    \"my_custom_plugin\": my_custom_plugin,  # Add your plugin\n}\n```\n\n## üîå Available Plugins\n\n### Host Inventory Plugin\n\nMonitors system resources via Telegraf metrics:\n\n- **Disk usage** monitoring with configurable paths\n- **CPU and memory** utilization tracking\n- **System load** monitoring\n- **Flexible alerting** based on thresholds\n\n### MongoDB Hotspots Plugin\n\nAnalyzes MongoDB performance:\n\n- **Slow query** detection and analysis\n- **Connection monitoring** and limits\n- **Performance profiling** integration\n- **Real-time operation** tracking\n\n## üõ†Ô∏è Operations\n\n### Development Commands\n\n```bash\n# Start development environment\nmake dev\n\n# View logs\nmake logs\nmake logs-agent\n\n# Test plugins\nmake test-plugins\n\n# Open shell in container\nmake shell\n\n# Reload configuration\nmake reload-config\n```\n\n### Production Commands\n\n```bash\n# Deploy production stack\nmake build && make up\n\n# Health checks\nmake health\nmake health-all\n\n# Monitor system\nmake monitor\n\n# Create backup\nmake backup\n\n# Clean up resources\nmake clean\n```\n\n### Scaling and High Availability\n\n```bash\n# Scale workers\ndocker-compose up --scale seed-agent=3\n\n# Run server and workers separately\ndocker-compose run seed-agent python seed-agent.py --mode server\ndocker-compose run seed-agent python seed-agent.py --mode worker\n```\n\n## üìä Monitoring and Observability\n\n### Built-in Metrics\n\n- Alert processing rates and latencies\n- Plugin execution times and success rates\n- Queue sizes and throughput\n- Error rates and types\n- System resource usage\n\n### Health Checks\n\n- **Application**: `/health` endpoint\n- **Dependencies**: RabbitMQ, Redis connectivity\n- **Plugins**: Periodic plugin health validation\n- **Docker**: Container-level health checks\n\n### Structured Logging\n\n```json\n{\n  \"timestamp\": \"2024-01-20T10:30:45Z\",\n  \"level\": \"INFO\",\n  \"component\": \"alert_processor\",\n  \"message\": \"Alert processed successfully\",\n  \"alert_name\": \"DiskSpaceHigh\",\n  \"hostname\": \"web-01\",\n  \"plugin\": \"host_inventory\",\n  \"duration_ms\": 245\n}\n```\n\n## üîí Security Best Practices\n\n### Container Security\n\n- **Non-root user**: Runs as dedicated `seed` user\n- **Minimal base image**: Python slim for reduced attack surface\n- **Resource limits**: Memory and CPU constraints\n- **Health checks**: Automatic container restart on failure\n\n### Network Security\n\n- **Internal network**: Isolated Docker network for services\n- **Port exposure**: Only necessary ports exposed\n- **TLS ready**: Configuration supports HTTPS/TLS\n\n### Configuration Security\n\n- **External secrets**: Sensitive data outside containers\n- **Environment variables**: Support for secret injection\n- **Read-only mounts**: Configuration files mounted read-only\n\n## üêõ Troubleshooting\n\n### Common Issues\n\n```bash\n# Check service status\ndocker-compose ps\n\n# View detailed logs\ndocker-compose logs -f seed-agent\n\n# Test connectivity\ncurl http://localhost:8080/health\n\n# Validate configuration\nmake validate-config\n\n# Test plugins individually\ndocker-compose exec seed-agent python plugins.py test host_inventory\n```\n\n### Performance Tuning\n\n- **Queue workers**: Adjust `system.agent.workers` in config\n- **Memory limits**: Tune container memory allocation\n- **Alert TTL**: Optimize `system.alerts.ttl_seconds`\n- **Batch processing**: Configure alert batching for high volumes\n\n## ü§ù Contributing\n\n### Development Setup\n\n1. **Clone repository**\n2. **Start development environment**: `make dev`\n3. **Make changes** to `seed.yaml`, `plugins.py`, or core code\n4. **Test changes**: `make test`\n5. **Submit pull request**\n\n### Plugin Development\n\nSee `plugins.py` for examples. New plugins should:\n\n- Accept standard parameters: `host`, `labels`, `annotations`, `payload`\n- Return formatted message string or `None`\n- Handle errors gracefully\n- Include comprehensive logging\n- Support async execution when needed\n\n## üìÑ License\n\nMIT License - see LICENSE file for details.\n\n---\n\n**SEED Agent v3** - Modern monitoring made simple üå±