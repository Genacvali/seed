# SEED Agent v4 - Production Ready Configuration
# No environment variables needed - all configured directly

# =============================================================================
# Environment Configuration
# =============================================================================
environment: "production"

# =============================================================================
# System Configuration
# =============================================================================
system:
  agent:
    bind_host: "0.0.0.0"
    bind_port: 8080
    workers: 2
    debug: false
    
  alerts:
    ttl_seconds: 120
    max_retries: 3
    retry_delay: 10

# =============================================================================
# Infrastructure Configuration - Ready to use with Docker Compose
# =============================================================================
infrastructure:
  # RabbitMQ settings (matches docker-compose.yml)
  rabbitmq:
    host: "127.0.0.1"
    port: 5672
    username: "admin"
    password: "admin"
    vhost: "/"
    
    # Queue configuration
    queues:
      alerts: "seed.alerts"
      retry: "seed.alerts.retry" 
      dlq: "seed.alerts.dlq"
      
  # Redis settings (matches docker-compose.yml)
  redis:
    host: "127.0.0.1"
    port: 6379
    db: 0
    password: null
    
  # Telegraf settings
  telegraf:
    scheme: "http"
    port: 9216
    endpoint: "/metrics"
    timeout: 30

# =============================================================================
# LLM Configuration (Optional - disabled by default)
# =============================================================================
llm:
  enabled: true
  provider: "gigachat"
  
  # GigaChat settings (Sber AI)
  gigachat:
    client_id: "e719ac5a-2040-4977-afc7-e120230859ce"
    client_secret: "e974a550-bd43-4e05-954e-286599998ab0"
    scope: "GIGACHAT_API_PERS"
    oauth_url: "https://ngw.devices.sberbank.ru:9443/api/v2/oauth"
    api_url: "https://gigachat.devices.sberbank.ru/api/v1/chat/completions"
    model: "GigaChat-2"
    verify_ssl: false
    token_cache: "/root/.cache/gigachat_token.json"
    timeout: 30

# =============================================================================
# Notification Configuration
# =============================================================================
notifications:
  # Mattermost webhook
  mattermost:
    enabled: true
    webhook_url: "https://mm.sberdevices.ru/hooks/p5777ztncinjxbetyeanw3dwqa"
    username: "SEED-Agent"
    icon_emoji: ":robot_face:"
    verify_ssl: false
    
  # Slack webhook - configure your webhook URL  
  slack:
    enabled: false
    webhook_url: "https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK"
    channel: "#alerts"
    username: "SEED-Agent"
    
  # Email notifications (SMTP) - configure your SMTP settings
  email:
    enabled: false
    smtp_host: "smtp.gmail.com"
    smtp_port: 587
    smtp_user: "your-email@gmail.com"
    smtp_password: "your-app-password"
    from_email: "seed-agent@yourcompany.com"
    to_emails:
      - "alerts@yourcompany.com"

# =============================================================================
# Host Groups Configuration - Example monitoring targets
# =============================================================================
hosts:
  groups:
    # Production MongoDB cluster
    mongo-prod:
      hosts:
        - "mongo-prod-01"
        - "mongo-prod-02" 
        - "mongo-prod-03"
      overrides:
        mongo_host: "localhost"
        mongo_port: 27017
        username: "monitoring"
        password: "secure_password"
        auth_db: "admin"
        telegraf_url: "http://{host}:9216/metrics"
        
    # Web servers
    web-servers:
      hosts:
        - "web-01"
        - "web-02" 
        - "web-03"
      overrides:
        telegraf_url: "http://{host}:9216/metrics"
        paths: ["/", "/var/www", "/opt"]
        
    # Test hosts (for demo)
    test-hosts:
      hosts:
        - "localhost"
        - "127.0.0.1"
      overrides:
        telegraf_url: "http://{host}:9216/metrics"
        paths: ["/", "/tmp"]
        
    # Test MongoDB hosts (for demo without real MongoDB)
    mongo-test:
      hosts:
        - "fake-mongo-01"
        - "fake-mongo-02"
      overrides:
        mongo_host: "localhost"
        mongo_port: 27017
        username: "test"
        password: "test"
        auth_db: "admin"
        telegraf_url: "http://{host}:9216/metrics"

# =============================================================================
# Alert Routing Configuration - Maps alert names to plugins
# =============================================================================
routing:
  alerts:
    # Disk space monitoring
    DiskSpaceHigh:
      plugin: "host_inventory"
      payload:
        paths: ["/", "/var", "/opt"]
        alert_type: "disk_space"
        priority: "high"
        timeout: 30
        
    DiskSpaceCritical:
      plugin: "host_inventory"
      payload:
        paths: ["/", "/var", "/opt"] 
        alert_type: "disk_critical"
        priority: "critical"
        timeout: 30
        
    # CPU and memory monitoring
    HighCpuLoad:
      plugin: "host_inventory"
      payload:
        paths: ["/"]
        alert_type: "cpu_load"
        priority: "warning"
        timeout: 30
        
    HighMemoryUsage:
      plugin: "host_inventory"
      payload:
        paths: ["/"]
        alert_type: "memory"
        priority: "warning"
        timeout: 30
        
    # General host inventory for testing
    TestHostInventory:
      plugin: "host_inventory"
      payload:
        paths: ["/", "/tmp"]
        alert_type: "general"
        priority: "normal"
        timeout: 30
        
    # MongoDB performance monitoring
    MongoSlowQuery:
      plugin: "mongo_hot"
      payload:
        min_ms: 100
        limit: 15
        priority: "high"
        timeout: 30
        
    MongoCollscan:
      plugin: "mongo_hot" 
      payload:
        min_ms: 50
        limit: 10
        priority: "high"
        timeout: 30

# =============================================================================
# Plugin Configuration
# =============================================================================
plugins:
  # Host inventory plugin settings
  host_inventory:
    default_paths: ["/", "/var"]
    default_timeout: 30
    telegraf_metrics:
      - "disk_used_percent"
      - "cpu_usage_idle"
      - "mem_used_percent"
      - "system_load1"
      
  # MongoDB hotspots plugin settings
  mongo_hot:
    default_min_ms: 50
    default_limit: 10
    connection_timeout: 10000
    profiler_enabled: true
    slow_op_sample_rate: 1.0

# =============================================================================
# Logging Configuration
# =============================================================================
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  
  # File logging
  file:
    enabled: true
    path: "/app/logs/seed-agent.log"
    max_size: "100MB"
    backup_count: 5
    
  # Console logging
  console:
    enabled: true
    colored: true

# =============================================================================
# Health Check Configuration  
# =============================================================================
health:
  enabled: true
  interval: 60
  
  checks:
    rabbitmq:
      enabled: true
      timeout: 5
      
    redis:
      enabled: true
      timeout: 5
      
    plugins:
      enabled: true
      test_interval: 300

# =============================================================================
# Metrics Configuration
# =============================================================================  
metrics:
  enabled: true
  
  # Prometheus metrics endpoint
  prometheus:
    enabled: true
    path: "/metrics"
    
  # Internal metrics
  internal:
    alerts_processed: true
    plugin_execution_time: true
    queue_size: true
    error_count: true